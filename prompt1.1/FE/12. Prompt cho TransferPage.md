Sinh code Flutter cho màn hình TransferPage theo Clean Architecture + BLoC/Cubit, kết nối với Payment API mock:

Yêu cầu UI:
- AppBar: title "Chuyển tiền" căn giữa
- Body: Form nhập thông tin chuyển tiền:
  1. Dropdown chọn loại chuyển: "Nội bộ" hoặc "Liên ngân hàng"
  2. Dropdown chọn tài khoản người chuyển
  2. TextField: Số tài khoản người nhận
  3. TextField: Tên người nhận (auto-fill mock khi nhập số tài khoản hợp lệ)
  4. TextField: Số tiền (chỉ nhập số, format VND, auto mask number nhập tiền)
  5. TextField: Nội dung chuyển khoản
  6. Button "Tiếp tục" → hiển thị màn hình xác nhận
- Màn hình xác nhận:
  - Hiển thị lại thông tin giao dịch (người nhận, số tài khoản, số tiền, nội dung, loại chuyển)
  - Hiện thị top dialog confirm otp để xác nhận chuyển tiền (dialog confirm otp gồm 6 digital number (default: 123456))
  - Button "Xác nhận" → gọi TransferCubit.transferMoney()
- Sau khi thành công → hiển thị dialog "Chuyển tiền thành công" + transactionId
- Nếu lỗi (ví dụ: số dư không đủ, idempotency key trùng) → hiển thị dialog lỗi

Yêu cầu kiến trúc:
- Tách code:
  - transfer_page.dart (UI form)
  - transfer_confirm_page.dart (UI xác nhận)
  - dialog_confirm_otp.dart (UI xác nhận otp)
  - transfer_cubit.dart (logic)
  - transfer_state.dart
- Domain layer: TransferEntity (id, sourceAccountId, targetAccount, amount, currency, type, description, status, createdAt)
- Data layer: TransferRepository (mock API gọi POST /transfers/internal hoặc /transfers/external)
- Khi gọi API:
  - Thêm header `Idempotency-Key` (UUID random cho mỗi request)
  - Nếu response trả về duplicate → hiển thị thông báo "Giao dịch đã được xử lý trước đó"
- TransferCubit:
  - validateForm()
  - transferMoney(type, payload)
  - emit state: TransferInitial, TransferLoading, TransferSuccess(transaction), TransferFailure(error)

Yêu cầu bổ sung:
- Sử dụng flutter_bloc để quản lý state
- Mock API backend:
  - /api/v1/transfers/internal
  - /api/v1/transfers/external
  - Trả về JSON: {transactionId, status, amount, targetAccount, createdAt}
- UI responsive, hỗ trợ keyboard safe area
- Thêm loading indicator khi đang gọi API
- Update routes trong main.dark
- Tích hợp menu_grid để mở TransferPage


Với prompt này, AI sẽ sinh ra:

UI TransferPage với form nhập liệu + màn hình xác nhận.
Cubit quản lý logic chuyển tiền (nội bộ/liên ngân hàng).
Repository mock gọi API với Idempotency-Key.
Xử lý thành công/thất bại giống backend thật.

Bảng entity account:
class Account {
  final String id;
  final String name;
  final String number;
  final double balance;
  final String currency; // 'VND' or 'USD'

  Account({required this.id, required this.name, required this.number, required this.balance, this.currency = 'VND'});
}

Account Repo
import '../entities/account.dart';
import '../entities/transaction_entity.dart';

abstract class AccountRepository {
  Future<List<Account>> getAccounts();
  Future<double> getBalance(String accountId);
  Future<List<TransactionEntity>> getTransactions(String accountId);
}

class MockAccountRepository implements AccountRepository {
  @override
  Future<List<Account>> getAccounts() async {
    await Future.delayed(const Duration(milliseconds: 300));
    return [
      Account(id: '1', name: 'Tài khoản chính', number: '0123456789', balance: 12500000.5, currency: 'VND'),
      Account(id: '2', name: 'Tiết kiệm', number: '0987654321', balance: 5000.0, currency: 'USD'),
    ];
  }

  @override
  Future<double> getBalance(String accountId) async {
    final list = await getAccounts();
    final a = list.firstWhere((e) => e.id == accountId, orElse: () => list.first);
    return a.balance;
  }

  @override
  Future<List<TransactionEntity>> getTransactions(String accountId) async {
    await Future.delayed(const Duration(milliseconds: 200));
    return [
      TransactionEntity(id: 't1', accountId: accountId, date: DateTime.now().subtract(const Duration(days: 1)), amount: -150000.0, description: 'Thanh toán hóa đơn'),
      TransactionEntity(id: 't2', accountId: accountId, date: DateTime.now().subtract(const Duration(days: 3)), amount: 2000000.0, description: 'Chuyển tiền'),
    ];
  }
}
